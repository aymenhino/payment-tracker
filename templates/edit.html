{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-6">✏️ Edit Payment</h1>

<div class="rounded-xl bg-white/80 dark:bg-gray-900/70 border border-gray-200 dark:border-gray-800 p-5 shadow-sm">
  <form id="editForm" action="{{ url_for('edit_payment', pid=payment.id) }}" method="post" enctype="multipart/form-data" class="grid md:grid-cols-2 gap-4">
    <div>
      <label class="text-sm opacity-80">Amount</label>
      <input required step="0.01" min="0" name="amount" type="number" value="{{ payment.amount }}" class="w-full mt-1 px-3 py-2 rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700">
    </div>
    <div>
      <label class="text-sm opacity-80">Recipient</label>
      <input required name="recipient" value="{{ payment.recipient }}" class="w-full mt-1 px-3 py-2 rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700">
    </div>

    <div>
      <label class="text-sm opacity-80">Date</label>
      <input required name="date" onfocus="this.type='date'" value="{{ payment.date.isoformat() }}" class="w-full mt-1 px-3 py-2 rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700">
    </div>
    <div>
      <label class="text-sm opacity-80">Notes</label>
      <input name="notes" value="{{ payment.notes or '' }}" class="w-full mt-1 px-3 py-2 rounded-md bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700">
    </div>

    <div class="md:col-span-2">
      <label class="text-sm opacity-80">Replace Receipt (optional)</label>
      <input name="receipt" type="file" class="block mt-1">
      {% if payment.receipt %}
        <a class="inline-block mt-2 text-sm text-brand-600 dark:text-brand-400 hover:underline" target="_blank" href="{{ url_for('uploaded_file', filename=payment.receipt) }}">Current receipt</a>
      {% endif %}
    </div>

    <div class="md:col-span-2 flex items-center gap-3">
      <button class="px-4 py-2 rounded-md bg-brand-600 text-white hover:bg-brand-500">💾 Save</button>
      <a href="{{ url_for('index') }}" class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-700">Cancel</a>
      <span id="saving" class="hidden text-sm opacity-70">Saving…</span>
    </div>
  </form>
</div>

<script>
  const editForm = document.getElementById('editForm');
  const saving   = document.getElementById('saving');
  editForm?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    saving.classList.remove('hidden');
    try{
      const res = await fetch(editForm.action, {method:'POST', body:new FormData(editForm), headers:{'X-Requested-With':'XMLHttpRequest'}});
      if(!res.ok) throw new Error('Save failed');
      showToast('Saved ✅'); setTimeout(()=>location.href="{{ url_for('index') }}", 300);
    }catch(err){ alert(err.message || 'Failed'); }
    finally{ saving.classList.add('hidden'); }
  });
</script>
{% endblock %}
